<h2 mat-dialog-title>Cadastro de Projeto</h2>

<mat-dialog-content>
  <form [formGroup]="projetoForm" (ngSubmit)="onSubmit()">
    <!-- Nome do Projeto -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Nome do Projeto</mat-label>
      <input matInput formControlName="nome" />
    </mat-form-field>

    <!-- Descrição -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Descrição</mat-label>
      <textarea matInput formControlName="descricao"></textarea>
    </mat-form-field>

    <!-- Fotos (Upload de Arquivos) -->
    <div formArrayName="photos">
      <div *ngFor="let photo of photos.controls; let i = index" [formGroupName]="i">
        <div class="file-upload-container">
          <label for="photo{{i}}" class="file-upload-label">Foto {{i + 1}}</label>
          <input type="file" id="photo{{i}}" (change)="onFileChange($event, i)" accept="image/*"
            class="file-upload-input" />
        </div>
        <div *ngIf="photosPreviews[i]" class="image-preview-container">
          <img [src]="photosPreviews[i]" alt="Pré-visualização da imagem" class="image-preview" />
        </div>
      </div>
      <button mat-button type="button" (click)="addPhoto()">Adicionar Foto</button>
    </div>

    <!-- Materiais -->
    <div formArrayName="material">
      <div *ngFor="let mat of material.controls; let i = index" [formGroupName]="i">
        <div class="form-group">
          <label for="mat{{i}}" class="file-upload-label">Material {{i + 1}}</label>
          <div class="row">
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Material</mat-label>
              <input matInput formControlName="material" />
            </mat-form-field>
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Quantidade/ML</mat-label>
              <input matInput type="number" formControlName="quantidade" />
            </mat-form-field>
          </div>
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Tempo Impressao</mat-label>
            <input matInput  formControlName="tempoImpressao" />
          </mat-form-field>
        </div>
      </div>
      <button mat-button type="button" (click)="addMaterial()">Adicionar Material</button>
    </div>
    <table mat-table [dataSource]="gastosList" class="mat-elevation-z8">
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef> Selecionar </th>
        <td mat-cell *matCellDef="let gasto">
          <mat-checkbox (change)="addGasto(gasto)"></mat-checkbox>
        </td>
      </ng-container>

      <ng-container matColumnDef="descricao">
        <th mat-header-cell *matHeaderCellDef> Descrição </th>
        <td mat-cell *matCellDef="let gasto">{{ gasto.gasto.name }}</td>
      </ng-container>
      <ng-container matColumnDef="categoria">
        <th mat-header-cell *matHeaderCellDef> Categoria </th>
        <td mat-cell *matCellDef="let gasto">{{ gasto.categoria }}</td>
      </ng-container>

      <ng-container matColumnDef="valor">
        <th mat-header-cell *matHeaderCellDef> Valor </th>
        <td mat-cell *matCellDef="let gasto">R${{ gasto.gasto.price }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </form>
</mat-dialog-content>

<mat-dialog-actions>
  <button mat-button (click)="onCancel()">Cancelar</button>
  <button mat-raised-button color="primary" type="submit" [disabled]="projetoForm.invalid"
    (click)="onSubmit()">Salvar</button>
</mat-dialog-actions>